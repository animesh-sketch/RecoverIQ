<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RecoverIQ | Collections Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<!-- â”€â”€ Sidebar â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">âš¡</div>
    <div>
      <div class="logo-title">RecoverIQ</div>
      <div class="logo-sub">Collections Intelligence</div>
    </div>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-item active"><span class="nav-icon">â—ˆ</span> Dashboard</div>
    <div class="nav-item" onclick="document.getElementById('fileInput').click()"><span class="nav-icon">â†‘</span> Upload CSV</div>
    <div class="nav-item" onclick="loadDemo()"><span class="nav-icon">â†º</span> Reset Demo</div>
  </nav>

  <div class="upload-zone" id="uploadZone">
    <input type="file" id="fileInput" accept=".csv" style="display:none" onchange="handleFileChange(event)" />
    <div class="upload-icon">ðŸ“‚</div>
    <div class="upload-title">Drop CSV here</div>
    <div class="upload-hint">or click to browse</div>
    <div class="upload-cols">
      Lead_Entity_Disposition<br>
      Lead_State Â· AI_Attempted_Calls<br>
      AI_Connected_Calls Â· Total_Spend_INR
    </div>
  </div>

  <div class="sidebar-data" id="sidebarData"></div>

  <div class="sidebar-footer">RecoverIQ v1.0 Â· AI-Powered</div>
</aside>

<!-- â”€â”€ Main â”€â”€ -->
<main class="main">

  <!-- Top bar -->
  <header class="topbar">
    <div class="topbar-left">
      <h1 class="page-title">Campaign Intelligence Dashboard</h1>
      <span class="page-sub">Executive View Â· Real-Time Analytics</span>
    </div>
    <div class="topbar-right">
      <span class="badge badge-ai">âš¡ AI-Powered</span>
      <span class="badge badge-live" id="dataLabel">Demo Data</span>
    </div>
  </header>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">Processing dataâ€¦</div>
  </div>

  <!-- Error banner -->
  <div class="error-banner" id="errorBanner">
    <span class="error-icon">âš </span>
    <span id="errorMsg"></span>
    <button class="error-close" onclick="hideError()">âœ•</button>
  </div>

  <!-- â”€â”€ Section 1: Campaign Overview â”€â”€ -->
  <section class="dash-section">
    <div class="section-header">
      <span class="sec-num">01</span>
      <span class="sec-title">Campaign Overview</span>
    </div>
    <div class="kpi-grid" id="kpiGrid"></div>
  </section>

  <!-- â”€â”€ Section 2: Campaign Score â”€â”€ -->
  <section class="dash-section">
    <div class="section-header">
      <span class="sec-num">02</span>
      <span class="sec-title">Campaign Score</span>
    </div>
    <div class="score-layout">
      <div id="scoreCard"></div>
      <div class="score-chart-wrap">
        <div class="chart-label">Score Component Breakdown</div>
        <canvas id="scoreChart"></canvas>
      </div>
    </div>
  </section>

  <!-- â”€â”€ Section 3: Funnel Intelligence â”€â”€ -->
  <section class="dash-section">
    <div class="section-header">
      <span class="sec-num">03</span>
      <span class="sec-title">Funnel Intelligence</span>
    </div>
    <div class="funnel-layout">
      <div class="funnel-left">
        <div class="chart-label">Campaign Conversion Funnel</div>
        <div id="funnelViz"></div>
      </div>
      <div class="funnel-right">
        <div class="chart-label">Drop-off Analysis</div>
        <div id="dropoffTable"></div>
        <div id="dropoffCallout"></div>
      </div>
    </div>
  </section>

  <!-- â”€â”€ Section 4: Efficiency Snapshot â”€â”€ -->
  <section class="dash-section">
    <div class="section-header">
      <span class="sec-num">04</span>
      <span class="sec-title">Efficiency Snapshot</span>
    </div>
    <div class="eff-layout">
      <div class="eff-col">
        <div class="chart-label">Retry &amp; Attempt Logic</div>
        <div id="retryTable"></div>
      </div>
      <div class="eff-col">
        <div class="chart-label">Cost Efficiency</div>
        <div id="costTable"></div>
      </div>
    </div>
    <div class="chart-label" style="margin-top:28px">Lead Disposition Distribution</div>
    <div class="chart-wrap">
      <canvas id="dispChart"></canvas>
    </div>
  </section>

  <!-- â”€â”€ Section 5: Risk Radar â”€â”€ -->
  <section class="dash-section">
    <div class="section-header">
      <span class="sec-num">05</span>
      <span class="sec-title">Risk Radar</span>
    </div>
    <div class="risk-grid" id="riskGrid"></div>
  </section>

  <!-- â”€â”€ Section 6: Optimization Levers â”€â”€ -->
  <section class="dash-section">
    <div class="section-header">
      <span class="sec-num">06</span>
      <span class="sec-title">Top 3 Optimization Levers</span>
    </div>
    <div id="leverList"></div>
  </section>

  <footer class="dash-footer">
    RecoverIQ Collections Intelligence Â· Powered by AI Â· Confidential
  </footer>
</main>

<script>
  const INITIAL_DATA = {{ initial_data | safe }};
</script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
